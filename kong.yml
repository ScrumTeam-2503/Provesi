_format_version: "2.1"

services:
  - host: manejador_pedidos_upstream
    name: manejador_pedidos_service
    protocol: http
    preserve_host: true
    routes:
      - name: manejador_pedidos
        paths:
          - /
          - /manejador_pedidos
        strip_path: false

  - host: manejador_inventario_upstream
    name: manejador_inventario_service
    protocol: http
    preserve_host: true
    routes:
      - name: manejador_inventario
        paths:
          - /manejador_inventario
        strip_path: false

upstreams:
  - name: manejador_pedidos_upstream
    targets:
      - target: <PEDIDOS_A_HOST>:8080
        weight: 100
      - target: <PEDIDOS_B_HOST>:8080
        weight: 100
      - target: <PEDIDOS_C_HOST>:8080
        weight: 100

    healthchecks:
      threshold: 50
      active:
        http_path: /health/
        timeout: 3
        healthy:
          successes: 2
          interval: 5
        unhealthy:
          tcp_failures: 2
          interval: 5

  - name: manejador_inventario_upstream
    targets:
      - target: <INVENTARIO_A_HOST>:8080
        weight: 100
      - target: <INVENTARIO_B_HOST>:8080
        weight: 100

    healthchecks:
      threshold: 50
      active:
        http_path: /health/
        timeout: 3
        healthy:
          successes: 2
          interval: 5
        unhealthy:
          tcp_failures: 2
          interval: 5