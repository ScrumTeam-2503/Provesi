â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  GUÃA DE CONFIGURACIÃ“N PARA DEPLOYMENT - PROVESI WMS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ PROBLEMA IDENTIFICADO:
--------------------------
El uso de "localhost" causa problemas en deployment porque:
- localhost solo funciona en la misma mÃ¡quina
- En Docker, cada contenedor tiene su propio localhost
- En servidores separados, necesitas IPs o nombres de host reales


âœ… SOLUCIÃ“N IMPLEMENTADA:
--------------------------
Ahora TODO usa variables de entorno configurables.


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ESCENARIOS DE DEPLOYMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Œ ESCENARIO 1: TODO EN LA MISMA MÃQUINA (Desarrollo)
------------------------------------------------------
Django y Microservicio en el mismo servidor.

En Django (.env):
  REPORTES_SERVICE_URL=http://127.0.0.1:8000

En Microservicio (.env):
  MONGODB_HOST=127.0.0.1  # o localhost


ğŸ“Œ ESCENARIO 2: SERVIDORES SEPARADOS (ProducciÃ³n Recomendada)
--------------------------------------------------------------
Django en Servidor A (ej: 192.168.1.10)
Microservicio en Servidor B (ej: 192.168.1.20)
MongoDB en Servidor C (ej: 192.168.1.30)

En Django (Servidor A - .env):
  REPORTES_SERVICE_URL=http://192.168.1.20:8000
  MONGODB_HOST=192.168.1.30

En Microservicio (Servidor B - .env):
  MONGODB_HOST=192.168.1.30
  DATABASE_HOST=34.229.88.183  # PostgreSQL


ğŸ“Œ ESCENARIO 3: DOCKER COMPOSE (Todos los servicios juntos)
------------------------------------------------------------
Crear un docker-compose.yml que incluya todo:

version: '3.8'
services:
  django:
    build: .
    environment:
      REPORTES_SERVICE_URL: http://servicio-reportes:8000
      MONGODB_HOST: mongodb
    depends_on:
      - servicio-reportes
      - mongodb
  
  servicio-reportes:
    build: ./servicio_reportes
    environment:
      MONGODB_HOST: mongodb
  
  mongodb:
    image: mongo:latest
    environment:
      MONGO_INITDB_ROOT_USERNAME: provesi_user
      MONGO_INITDB_ROOT_PASSWORD: scrumteam

En este caso, usar nombres de servicio:
  REPORTES_SERVICE_URL=http://servicio-reportes:8000
  MONGODB_HOST=mongodb


ğŸ“Œ ESCENARIO 4: CON KONG API GATEWAY
-------------------------------------
Si usas Kong como API Gateway:

En Django (.env):
  REPORTES_SERVICE_URL=http://kong:8000

Kong redirige /reportes/* al microservicio.


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  CONFIGURACIÃ“N PASO A PASO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”§ PASO 1: Configurar Django
-----------------------------
1. Crear archivo .env en la raÃ­z del proyecto:
   cp .env.example .env

2. Editar .env y configurar REPORTES_SERVICE_URL segÃºn tu escenario:
   
   # Para desarrollo local:
   REPORTES_SERVICE_URL=http://localhost:8000
   
   # Para servidor separado (cambiar IP):
   REPORTES_SERVICE_URL=http://192.168.1.20:8000
   
   # Para Docker Compose:
   REPORTES_SERVICE_URL=http://servicio-reportes:8000

3. Asegurarse que Django cargue las variables:
   En settings.py ya estÃ¡ configurado para usar os.getenv()


ğŸ”§ PASO 2: Configurar Microservicio de Reportes
------------------------------------------------
1. Ir a la carpeta del microservicio:
   cd servicio_reportes

2. Crear archivo .env:
   cp .env.example .env

3. Editar .env segÃºn tu escenario:
   
   # PostgreSQL (usar IP real)
   DATABASE_HOST=34.229.88.183
   
   # MongoDB segÃºn escenario:
   # Mismo servidor:
   MONGODB_HOST=localhost
   
   # Servidor separado (cambiar IP):
   MONGODB_HOST=192.168.1.30
   
   # Docker Compose:
   MONGODB_HOST=mongodb


ğŸ”§ PASO 3: Ejecutar los Servicios
----------------------------------

OPCIÃ“N A - Docker Compose (Recomendado):
  cd servicio_reportes
  docker-compose up -d

OPCIÃ“N B - Docker Manual:
  cd servicio_reportes
  docker build -t provesi-reportes .
  docker run -d --name provesi-reportes \
    -p 8000:8000 \
    --env-file .env \
    provesi-reportes

OPCIÃ“N C - EjecuciÃ³n Local:
  cd servicio_reportes
  python -m venv venv
  source venv/bin/activate
  pip install -r requirements.txt
  uvicorn main:app --host 0.0.0.0 --port 8000


ğŸ”§ PASO 4: Verificar Conectividad
----------------------------------
1. Desde el servidor de Django, verificar que puede alcanzar el microservicio:
   
   curl http://192.168.1.20:8000/health
   
   Debe retornar:
   {"status":"ok","service":"Servicio de Reportes",...}

2. Verificar desde el navegador:
   http://tu-servidor-django/reportes/

3. El indicador de estado debe estar verde.


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TROUBLESHOOTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ Error: "No se pudo conectar con el servicio de reportes"
-----------------------------------------------------------
Causa: Django no puede alcanzar el microservicio.

Soluciones:
1. Verificar que el microservicio estÃ© corriendo:
   docker ps | grep provesi-reportes
   
2. Verificar la URL configurada:
   echo $REPORTES_SERVICE_URL
   
3. Hacer ping desde Django al servidor del microservicio:
   ping 192.168.1.20
   
4. Verificar firewall:
   sudo ufw status
   sudo ufw allow 8000/tcp
   
5. Verificar que el puerto estÃ© abierto:
   netstat -tulpn | grep 8000


âŒ Error: "Error conectando a MongoDB"
---------------------------------------
Causa: El microservicio no puede conectarse a MongoDB.

Soluciones:
1. Verificar que MongoDB estÃ© corriendo:
   systemctl status mongodb
   
2. Verificar la IP configurada:
   echo $MONGODB_HOST
   
3. Probar conexiÃ³n manual:
   mongosh --host 192.168.1.30 --port 27017 -u provesi_user -p scrumteam
   
4. Verificar firewall en servidor MongoDB:
   sudo ufw allow 27017/tcp


âŒ Error: "Connection refused"
-------------------------------
Causa: El servicio no estÃ¡ escuchando en 0.0.0.0

SoluciÃ³n:
Asegurarse que el microservicio use:
  uvicorn main:app --host 0.0.0.0 --port 8000
  
NO usar:
  uvicorn main:app --host 127.0.0.1 --port 8000


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  COMANDOS ÃšTILES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Ver logs del microservicio (Docker)
docker logs -f provesi-reportes

# Ver logs del microservicio (systemd)
sudo journalctl -u provesi-reportes -f

# Reiniciar microservicio (Docker)
docker restart provesi-reportes

# Reiniciar microservicio (systemd)
sudo systemctl restart provesi-reportes

# Verificar conectividad
curl http://IP:8000/health

# Ver variables de entorno cargadas
docker exec provesi-reportes env | grep REPORTES


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  CHECKLIST DE DEPLOYMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Servidor del Microservicio:
  â˜ Microservicio corriendo en puerto 8000
  â˜ Escuchando en 0.0.0.0 (no 127.0.0.1)
  â˜ Firewall permite puerto 8000
  â˜ Variable MONGODB_HOST configurada correctamente
  â˜ Variable DATABASE_HOST configurada correctamente
  â˜ Health check responde: curl http://IP:8000/health

Servidor de Django:
  â˜ Variable REPORTES_SERVICE_URL configurada
  â˜ Puede hacer ping al servidor del microservicio
  â˜ Puede hacer curl al health check del microservicio
  â˜ PÃ¡gina /reportes/ carga correctamente
  â˜ Indicador de estado estÃ¡ verde

Servidor de MongoDB:
  â˜ MongoDB corriendo en puerto 27017
  â˜ Firewall permite puerto 27017
  â˜ Usuario provesi_user creado
  â˜ Base de datos provesi_mongodb existe

Red:
  â˜ Todos los servidores pueden comunicarse entre sÃ­
  â˜ No hay firewalls bloqueando los puertos necesarios
  â˜ DNS/IPs resuelven correctamente


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  RESUMEN DE CAMBIOS REALIZADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… provesi/reportes_views.py
   CambiÃ³: REPORTES_SERVICE_URL = 'http://localhost:8000'
   A: REPORTES_SERVICE_URL = os.getenv('REPORTES_SERVICE_URL', 'http://servicio-reportes:8000')

âœ… servicio_reportes/database.py
   CambiÃ³: 'host': os.getenv("MONGODB_HOST", "localhost")
   A: 'host': os.getenv("MONGODB_HOST", "mongodb")

âœ… servicio_reportes/Dockerfile
   CambiÃ³: ENV MONGODB_HOST=localhost
   A: ENV MONGODB_HOST=mongodb

âœ… servicio_reportes/docker-compose.yml
   CambiÃ³: MONGODB_HOST: ${MONGODB_HOST:-localhost}
   A: MONGODB_HOST: ${MONGODB_HOST:-mongodb}

âœ… Creados archivos de configuraciÃ³n:
   - .env.example (Django)
   - .env.production (Microservicio)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Â¡Listo! Ahora el sistema es completamente configurable y funciona
en cualquier escenario de deployment. ğŸš€

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

