{% extends 'base.html' %}
{% load humanize %}

{% block content %}
<div class="container">
    
    <!-- Encabezado -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Estantería {{ estanteria.zona }}-{{ estanteria.codigo }}</h2>
        <a href="{% url 'bodegaDetail' estanteria.bodega.codigo %}" class="btn btn-primary">
            ← Volver
        </a>
    </div>
    <p><b>Bodega:</b> {{ estanteria.bodega.codigo }}</p>
    <p><b>Niveles:</b> {{ estanteria.niveles }}</p>
    <p><b>Ubicaciones:</b> {{ ubicaciones|length }}</p>

    <hr>

    <div class="d-flex justify-content-between align-items-center">
        <h3>Ubicaciones</h3>
        <button 
            type="button" 
            class="btn btn-success"
            onclick="window.location.href='{% url 'addUbicacion' estanteria.bodega.codigo estanteria.zona estanteria.codigo %}'">
            <i class="bi bi-plus-circle"></i> Agregar
        </button>
    </div>

    {% if ubicaciones %}
        <div class="mt-4">
            {% for ubicacion in ubicaciones %}
                <div class="card mb-3 shadow-sm">
                    <div class="row g-0 align-items-center">
                        <!-- Col izquierda: producto -->
                        <div class="col-md-4 p-3 border-end">
                            {% if ubicacion.producto %}
                                <h5 class="card-title mb-2">{{ ubicacion.producto.nombre }}</h5>
                                {% if ubicacion.producto.imagen %}
                                    <img src="{{ ubicacion.producto.imagen.url }}" 
                                         class="img-fluid rounded" 
                                         alt="{{ ubicacion.producto.nombre }}">
                                {% else %}
                                    <p class="text-muted">Sin imagen</p>
                                {% endif %}
                            {% else %}
                                <div class="text-center text-muted py-4">
                                    <i class="bi bi-box-seam" style="font-size: 2rem;"></i>
                                    <p class="mt-2 mb-0">Ubicación vacía</p>
                                </div>
                            {% endif %}
                        </div>

                        <!-- Col derecha: info -->
                        <div class="col-md-8 p-3">
                            <p><b>Código ubicación:</b> {{ estanteria.zona }}{{ estanteria.codigo }}{{ ubicacion.nivel }}{{ ubicacion.codigo }}</p>
                            <p><b>Capacidad:</b> {{ ubicacion.capacidad }}</p>
                            <p><b>Stock:</b> {{ ubicacion.stock }}</p>
                            <p><b>Última actualización:</b> {{ ubicacion.fecha_actualizacion|naturaltime }}</p>

                            <div class="text-end">
                                <a href="{% url 'home' %}" 
                                   class="btn btn-outline-primary btn-sm">
                                   Modificar
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted mt-3">No hay ubicaciones creadas en esta estantería.</p>
    {% endif %}
</div>
{% endblock %}
